<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif !important;
        }

        div {
            background-color: #32383e;
        }

        .btn-action {
            width: 120px;
        }

        #PlayersInputTbody>tr>td {
            position: relative;
        }

        #PlayersInputTbody>tr>td>input {
            position: absolute;
            display: block;
            top: 0;
            left: 0;
            margin: 0;
            margin-top: 15%;
            height: 60%;
            width: 100%;
            border: none;
            /* padding: 10px; */
            box-sizing: border-box;
            text-align: center;
            font-size: 1.1em;
            border-radius: 5px;
        }

        #PlayersInputTbody>tr>td {
            vertical-align: middle;
        }
    </style>
    <title>حسابة كنكان</title>
</head>

<body class="text-right pt-3 bg-dark" onload="Init()">
    <div id="MainContainer" class="container p-1">
        <div class="card bg-dark text-white border-white">
            <div class="card-header border-white">
                <div class="card-title">
                    <h3>حسابة كنكان</h3>
                </div>
            </div>
            <div class="card-body p-2" dir="rtl">
                <div class="m-2 justify-content-center">
                    <div class="col-12 text-center">
                        <button class="btn btn-success btn-action m-1" onclick="InitAction('Hand')">هند</button>
                        <button class="btn btn-warning btn-action m-1" onclick="InitAction('SuperHand')">سوبر
                            هند</button>
                        <button class="btn btn-danger btn-action m-1" onclick="InitAction('FullHand')">فل هند</button>
                        <button class="btn btn-primary btn-action m-1" onclick="InitAction('Finished')">خالص</button>
                    </div>
                </div>
                <hr>
                <div class="input-group mb-3" dir="ltr">
                    <div class="input-group-prepend">
                        <button class="btn btn-primary" onclick="doAction()" type="button">اضافة</button>
                    </div>
                    <input id="PlayerNameInput" type="text" class="form-control text-right" placeholder="اسم لاعب" />
                </div>
                <table id="PlayersTable" class="table text-center table-dark">
                    <thead>
                        <th scope="col">الترتيب</th>
                        <th scope="col">اسم اللاعب</th>
                        <th scope="col">النقاط</th>
                    </thead>
                    <tbody id="PlayersTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="PlayersInputModal" tabindex="-1" role="dialog" aria-labelledby="PlayersInputModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content bg-dark text-white border-white p-1" dir="rtl">
                <div class="modal-header bg-dark text-white border-white">
                    <h4 class="modal-title" id="PlayersInputModalLabel">تسجيل</h4>
                </div>
                <div class="modal-body p-1" id="PlayersInputModal">
                    <table id="PlayersTable" class="table text-center table-dark">
                        <thead>
                            <!-- <th scope="col">الترتيب</th> -->
                            <th scope="col">اسم اللاعب</th>
                            <th scope="col">النقاط</th>
                            <th scope="col"></th>
                        </thead>
                        <tbody id="PlayersInputTbody"></tbody>
                    </table>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" style="width: 100px;"
                        data-dismiss="modal">الغاء</button>
                    <button type="button" class="btn btn-primary" style="width: 100px;"
                        onclick="doAction(false)">تم</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script>

        function Init() {
            window.Players = [];
        }
        function AddPlayer() {
            let id = window.Players.length + 1;
            let name = document.getElementById("PlayerNameInput");
            window.Players.push({
                ID: id,
                Name: name.value,
                Score: 0,
            });

            let tbody = document.getElementById("PlayersTbody");
            let tr = document.createElement("tr");
            let tdSort = document.createElement("td");
            let tdName = document.createElement("td");
            let tdScore = document.createElement("td");
            tdScore.classList.add("text-center");
            let tdActions = document.createElement("td");

            tr.id = id;
            tdName.innerText = name.value;
            tdScore.innerText = 0;
            tdSort.innerText = id;
            tdSort.style.textAlign = "center";
            tr.appendChild(tdSort);
            tr.appendChild(tdName);
            tr.appendChild(tdScore);
            tr.appendChild(tdActions);
            tbody.appendChild(tr);
            name.value = "";
        }

        function InitAction(actionType) {
            let multipleBy = 1;
            let isHandType = false;
            let arActionName = '';
            switch (actionType) {
                case "Hand":
                    multipleBy = 1;
                    isHandType = true;
                    arActionName = 'هند';
                    break;
                case "SuperHand":
                    multipleBy = 2
                    isHandType = true;
                    arActionName = 'سوبر هند';
                    break;
                case "FullHand":
                    multipleBy = 3;
                    isHandType = true;
                    arActionName = 'فل هند';
                    break;
                case "Finished":
                    multipleBy = 1;
                    isHandType = false;
                    arActionName = 'خالص';
                    break;
            }
            let loserNum = isHandType == true ? 200 : 100;
            let winnerNum = isHandType == true ? -60 : -30;
            let actionScore = loserNum * multipleBy;

            let tbody = document.getElementById("PlayersInputTbody");
            tbody.innerHTML = "";
            for (let i = 0; i < window.Players.length; i++) {

                //tr
                let tr = document.createElement("tr");
                tr.id = 'input-tr-' + window.Players[i].ID;

                //Name
                let tdName = document.createElement("td");
                tdName.innerText = window.Players[i].Name;
                tr.appendChild(tdName);

                //Score
                let tdScore = document.createElement("td");
                tdScore.classList.add("text-center");
                inputScore = document.createElement("input");
                let inputId = "input-box-" + window.Players[i].ID;
                inputScore.id = inputId;
                inputScore.value = actionScore;
                inputScore.type = "tel";
                inputScore.addEventListener("click", function (e) {
                    e.target.value = "";
                });
                tdScore.appendChild(inputScore);
                tr.appendChild(tdScore);

                let tdActions = document.createElement("td");

                //Plus Btn
                if (isHandType) {
                    let plus50 = document.createElement("button");
                    plus50.addEventListener("click", function (e) {
                        document.getElementById(inputId).value = (50 * multipleBy) + actionScore;
                        let plusBtns = document.getElementsByClassName("plus-btn");
                        for(let i=0;i<plusBtns.length; i++){
                            plusBtns[i].disabled = true;
                            plusBtns[i].classList = ['btn btn-secondary mx-1 plus-btn'];
                        }
                    });
                    plus50.classList = ['btn btn-primary mx-1 plus-btn'];
                    plus50.innerText = "+" + (50 * multipleBy);
                    tdActions.appendChild(plus50);
                }

                // Action Btn
                let actionBtn = document.createElement("button");
                actionBtn.addEventListener("click", function (e) {
                    document.getElementById(inputId).value = winnerNum * multipleBy;
                    let actionBtns = document.getElementsByClassName("action-btn");
                        for(let i=0;i<actionBtns.length; i++){
                            actionBtns[i].disabled = true;
                            actionBtns[i].classList = ['btn btn-secondary action-btn'];
                        }
                });
                actionBtn.classList = ['btn btn-success action-btn'];
                actionBtn.innerText = arActionName;
                tdActions.appendChild(actionBtn);
                tdActions.classList.add("text-center");
                tr.appendChild(tdActions);
                tbody.appendChild(tr);

            }
            $('#PlayersInputModal').modal('toggle')
        }

        function doAction(isAddPlayer = true) {
            let tbody = document.getElementById("PlayersTbody");
            if (isAddPlayer) {
                let id = window.Players.length + 1;
                let name = document.getElementById("PlayerNameInput");
                window.Players.push({
                    ID: id,
                    Name: name.value,
                    Score: 0,
                });
                name.value = "";
            }
            tbody.innerHTML = "";
            for (let i = 0; i < window.Players.length; i++) {
                let playerID = window.Players[i].ID;
                if (!isAddPlayer) {
                    let input = document.getElementById("input-box-" + playerID);
                    window.Players[i].Score += parseInt(input.value);
                }
                let tr = document.createElement("tr");
                let tdSort = document.createElement("td");
                let tdName = document.createElement("td");
                let tdScore = document.createElement("td");
                tr.id = playerID;

                tdSort.innerText = playerID;
                tdSort.style.textAlign = "center";

                tdName.innerText = window.Players[i].Name;

                tdScore.innerText = window.Players[i].Score;
                tdScore.style.textAlign = "center";

                tr.appendChild(tdSort);
                tr.appendChild(tdName);
                tr.appendChild(tdScore);
                tbody.appendChild(tr);
            }
            if (!isAddPlayer) {
                $('#PlayersInputModal').modal('toggle');
            }
        }
    </script>
</body>

</html>
